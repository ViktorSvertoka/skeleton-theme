<script src="{{ 'reviews.js' | asset_url }}" defer></script>

<section class="pt-10 pb-20" data-reviews-section>
  <div class="container">

    {% liquid
      assign target_product = product | default: section.settings.product

      if target_product
        assign reviews_field = target_product.metafields.custom.reviews_json

        if reviews_field.value != blank
          assign reviews = reviews_field.value
        elsif reviews_field != blank
          assign reviews = reviews_field
        endif
      endif
    %}

    {% if target_product == blank %}
      <p class="text-center text-gray">
        Select a product for this section to display reviews.
      </p>

    {% elsif reviews != blank %}
      <h2 class="text-center text-3xl mb-10">
        Reviews
      </h2>

      <div class="reviews-slider" data-reviews-slider>
        <div class="swiper" data-reviews-swiper>
          <div class="swiper-wrapper">

            {% for review in reviews %}
              {% render 'review-card', review: review %}
            {% endfor %}

          </div>
        </div>

        <div class="flex items-center justify-between mt-6 gap-4">
          <div
            class="swiper-pagination static! w-auto!"
            data-reviews-pagination
          ></div>

          <div class="flex gap-2">
            <button
              type="button"
              class="w-10 h-10 rounded-full border border-stroke flex items-center justify-center text-dark hover:bg-dark hover:text-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-dark focus-visible:ring-offset-2 transition"
              data-reviews-prev
              aria-label="Previous review"
            >
              <svg class="w-4 h-4 fill-current">
                <use href="{{ 'sprite.svg' | asset_url }}#arrow-left"></use>
              </svg>
            </button>

            <button
              type="button"
              class="w-10 h-10 rounded-full border border-stroke flex items-center justify-center text-dark hover:bg-dark hover:text-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-dark focus-visible:ring-offset-2 transition"
              data-reviews-next
              aria-label="Next review"
            >
              <svg class="w-4 h-4 fill-current">
                <use href="{{ 'sprite.svg' | asset_url }}#arrow-right"></use>
              </svg>
            </button>
          </div>
        </div>
      </div>

    {% else %}
      <p class="text-center text-gray">
        No reviews yet...
      </p>
    {% endif %}

  </div>
</section>

{% schema %}
{
  "name": "Reviews",
  "tag": "section",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Product"
    }
  ],
  "presets": [
    {
      "name": "Reviews"
    }
  ]
}
{% endschema %}
